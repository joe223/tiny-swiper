{"version":3,"file":"autoPlay.js","sources":["../../src/core/render/dom.ts","../../src/core/eventHub.ts","../../src/modules/autoPlay.ts"],"sourcesContent":["export function addClass (\n    el: HTMLElement,\n    list: Array<string> | string = []\n): void {\n    if (!Array.isArray(list)) list = [list]\n\n    list.forEach(clz => (!el.classList.contains(clz) && el.classList.add(clz)))\n}\n\nexport function removeClass (\n    el: HTMLElement,\n    list: Array<string> | string = []\n): void {\n    if (!Array.isArray(list)) list = [list]\n\n    list.forEach(clz => (el.classList.contains(clz) && el.classList.remove(clz)))\n}\n\nexport function attachListener (\n    el: HTMLElement | Document | Window,\n    evtName: string,\n    handler: EventListenerOrEventListenerObject,\n    opts?: boolean | AddEventListenerOptions\n): void {\n    el.addEventListener(evtName, handler, opts)\n}\n\nexport function detachListener (\n    el: HTMLElement | Document | Window,\n    evtName: string,\n    handler: EventListenerOrEventListenerObject\n): void {\n    el.removeEventListener(evtName, handler)\n}\n\nexport function removeAttr (\n    el: HTMLElement,\n    attr: string\n): void {\n    el.removeAttribute(attr)\n}\n\nexport function setAttr (\n    el: HTMLElement,\n    attr: string,\n    value = ''\n): HTMLElement {\n    el.setAttribute(attr, value)\n    return el\n}\n\nexport function setStyle (\n    el: HTMLElement,\n    style: {[key: string]: string},\n    forceRender?: boolean\n): HTMLElement {\n    Object.keys(style).forEach(prop => {\n        // TS7015: Element implicitly has an 'any' type because index expression is not of type 'number'.\n        el.style[prop as any] = style[prop]\n    })\n    // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n    forceRender && getComputedStyle(el)\n\n    return el\n}\n\nexport function getTranslate (\n    el: HTMLElement,\n    isHorizontal: boolean\n): number {\n    const matrix = getComputedStyle(el).transform.replace(/[a-z]|\\(|\\)|\\s/g, '').split(',').map(parseFloat)\n    let arr: Array<number> = []\n\n    if (matrix.length === 16) {\n        arr = matrix.slice(12, 14)\n    } else if (matrix.length === 6) {\n        arr = matrix.slice(4, 6)\n    }\n    return (<Array<number>>arr)[isHorizontal ? 0 : 1] || 0\n}\n","export type EventHub = {\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    on (evtName: string, cb: Function): void\n    off (evtName: string, cb: Function): void\n    emit (evtName: string, ...data: Array<any>): void\n    clear (): void\n}\n\nexport const LIFE_CYCLES = {\n    BEFORE_INIT: 'before-init',\n    AFTER_INIT: 'after-init',\n    BEFORE_SLIDE: 'before-slide',\n    SCROLL: 'scroll',\n    AFTER_SLIDE: 'after-slide',\n    BEFORE_DESTROY: 'before-destroy',\n    AFTER_DESTROY: 'after-destroy'\n}\n\nexport function EventHub (): EventHub {\n    let hub: {\n        [key: string]: Array<Function>\n    } = {}\n\n    function on (evtName: string, cb: Function): void {\n        if (!hub[evtName]) {\n            hub[evtName] = [cb]\n        } else {\n            hub[evtName].push(cb)\n        }\n    }\n\n    function off (evtName: string, cb: Function): void {\n        if (hub[evtName]) {\n            const index = hub[evtName].indexOf(cb)\n\n            // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n            index > -1 && hub[evtName].splice(index, 1)\n        }\n    }\n\n    function emit (evtName: string, ...data: Array<any>): void {\n        if (hub[evtName]) {\n            hub[evtName].forEach(cb => cb(...data))\n        }\n    }\n\n    function clear (): void {\n        hub = {}\n    }\n\n    return {\n        on,\n        off,\n        emit,\n        clear\n    }\n}\n","import {\n    attachListener,\n    detachListener\n} from '../core/render/dom'\nimport { SwiperInstance, SwiperPlugin } from '../core/index'\nimport { Options } from '../core/options'\nimport { LIFE_CYCLES } from '../core/eventHub'\n\nexport type SwiperPluginAutoPlayOptions = {\n    delay: number\n    disableOnInteraction: boolean\n    reverseDirection: boolean\n    stopOnLastSlide: boolean\n    waitForTransition: boolean\n}\n\nexport type SwiperPluginAutoPlayPartialOptions = Partial<SwiperPluginAutoPlayOptions> | boolean\n\nexport type SwiperPluginAutoPlayInstance = {}\n\n/**\n * TinySwiper plugin for auto paly.\n *\n * @param {SwiperInstance} instance\n * @param {Options}\n */\nexport default <SwiperPlugin>function SwiperPluginAutoPlay (\n    instance: SwiperInstance & {\n        autoplay?: SwiperPluginAutoPlayInstance\n    },\n    options: Options\n): void {\n    const isEnable = Boolean(options.autoplay)\n\n    if (!isEnable) return\n\n    const autoPlayOptions = <SwiperPluginAutoPlayOptions>Object.assign({\n        delay: 3000,\n        disableOnInteraction: true,\n        reverseDirection: false,\n        stopOnLastSlide: false,\n        waitForTransition: true\n    }, options.autoplay)\n    const hook = autoPlayOptions.waitForTransition\n        ? LIFE_CYCLES.AFTER_SLIDE\n        : LIFE_CYCLES.BEFORE_SLIDE\n    const {\n        touchable\n    } = instance.env\n    const {\n        $el\n    } = instance.env.element\n    const autoPlayState = {\n        pause: false,\n        timeoutId: void 0\n    }\n\n    function play () {\n        const {\n            state,\n            env\n        } = instance\n\n        if (!(autoPlayOptions.stopOnLastSlide && state.index >= env.limitation.maxIndex)\n            && !autoPlayState.pause\n            && !autoPlayState.timeoutId\n        ) {\n            autoPlayState.timeoutId = <any>setTimeout(() => {\n                const newIndex = autoPlayOptions.reverseDirection\n                    ? state.index - 1 : state.index + 1\n                const computedIndex = newIndex > env.limitation.maxIndex\n                    ? env.limitation.minIndex\n                    : newIndex < env.limitation.minIndex\n                        ? env.limitation.maxIndex\n                        : newIndex\n\n                instance.slideTo(computedIndex)\n                autoPlayState.timeoutId = void 0\n            }, autoPlayOptions.delay)\n        }\n    }\n\n    function onTouchStart () {\n        clearTimeout(autoPlayState.timeoutId)\n        autoPlayState.pause = true\n        autoPlayState.timeoutId = void 0\n    }\n\n    function onTouchEnd () {\n        autoPlayState.pause = false\n        play()\n    }\n\n    instance.on(\n        hook,\n        play\n    )\n\n    instance.on(LIFE_CYCLES.AFTER_INIT, () => {\n        if (touchable) {\n            attachListener($el, 'touchstart', onTouchStart)\n            attachListener($el, 'touchend', onTouchEnd)\n            attachListener($el, 'touchcancel', onTouchEnd)\n        } else {\n            attachListener($el, 'mousedown', onTouchStart)\n            attachListener(document, 'mouseup', onTouchEnd)\n        }\n    })\n\n    instance.on(LIFE_CYCLES.AFTER_DESTROY, () => {\n        if (touchable) {\n            detachListener($el, 'touchstart', onTouchStart)\n            detachListener($el, 'touchend', onTouchEnd)\n            detachListener($el, 'touchcancel', onTouchEnd)\n        } else {\n            detachListener($el, 'mousedown', onTouchStart)\n            detachListener(document, 'mouseup', onTouchEnd)\n        }\n    })\n}\n"],"names":["attachListener","el","evtName","handler","opts","addEventListener","detachListener","removeEventListener","LIFE_CYCLES","BEFORE_INIT","AFTER_INIT","BEFORE_SLIDE","SCROLL","AFTER_SLIDE","BEFORE_DESTROY","AFTER_DESTROY","SwiperPluginAutoPlay","instance","options","isEnable","Boolean","autoplay","autoPlayOptions","Object","assign","delay","disableOnInteraction","reverseDirection","stopOnLastSlide","waitForTransition","hook","touchable","env","$el","element","autoPlayState","pause","timeoutId","play","state","index","limitation","maxIndex","setTimeout","newIndex","computedIndex","minIndex","slideTo","onTouchStart","clearTimeout","onTouchEnd","on","document"],"mappings":"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"}